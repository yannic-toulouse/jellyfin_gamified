# Jellyfin Gamified

A leaderboard system for your Jellyfin server that tracks watch activity and rewards users with points based on their watch time. Designed for self-hosters who want to add a fun, competitive element to their media server.

## Overview

Jellyfin Gamified consists of two components:

- **JellyfinPollster** — A Python script that periodically polls your Jellyfin server, records watch activity into a local SQLite database, calculates points, and exports a JSON file.
- **JellyfinDashboard** — A PHP web app that reads the exported JSON and displays a leaderboard with daily, weekly, and all-time stats.

Users earn points based on how long they watch — half a point per minute of runtime. Stats include total points, watch time, current streak, and weekly breakdowns.

## Requirements

- Python 3.8+
- A running Jellyfin server with API access
- A web server with PHP (for the Dashboard)

## Installation

### JellyfinPollster

1. Clone the repository:
   ```bash
   git clone https://github.com/yannic-toulouse/jellyfin_gamified.git
   cd jellyfin_gamified/JellyfinPollster
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Copy the example environment file and fill in your values:
   ```bash
   cp .env.example .env
   ```

4. Set up the SQLite database:
   ```bash
   python setup.py
   ```

5. Run the pollster manually to verify everything works:
   ```bash
   python main.py
   ```

### JellyfinDashboard

Place the `JellyfinDashboard` directory in your web server's document root (or a subdirectory). Make sure PHP is enabled and the server can read the `data/users.json` file generated by the Pollster.

## Configuration

The Pollster is configured via a `.env` file in the `JellyfinPollster` directory:

| Variable | Description |
|---|---|
| `JELLY_DOMAIN` | The base URL of your Jellyfin server (e.g. `http://192.168.1.10:8096`) |
| `API_KEY` | Your Jellyfin API key (found in Dashboard → API Keys) |

## Scheduling with Cron

To keep the leaderboard up to date, schedule the Pollster to run at regular intervals using cron. For example, to run every 15 minutes:

```bash
crontab -e
```

Add the following line (adjust the path to match your installation):

```
*/15 * * * * /usr/bin/python3 /path/to/jellyfin_gamified/JellyfinPollster/main.py
```

## How It Works

1. **JellyfinPollster** queries the Jellyfin API for each user's recently played movies and episodes.
2. New plays (since the last run) are stored in a local SQLite database, along with item metadata.
3. Points are calculated at 0.5 points per minute of runtime and recorded in a points ledger.
4. Daily and weekly stats, streaks, and monthly totals are aggregated and exported to `data/users.json`.
5. **JellyfinDashboard** reads `users.json` and renders the leaderboard, sorted by points, daily play count, and latest activity.
